<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.appinfo.mapper.appversion.AppVersionMapper">
	<select id="getVesionByAppId" resultType="com.appinfo.pojo.AppVersion">
		SELECT v.*,
		(SELECT a.softwareName FROM `app_info` a WHERE a.id=
		v.appId) AS softwareName
		,
		(SELECT d.valueName FROM `data_dictionary` d
		WHERE d.typeCode='APP_STATUS'
		AND d.valueId=v.publishStatus) AS
		publishStatusName
		FROM `app_version` v
		<where>
			<if test="aid !=0 and aid != null">
				appId=#{aid}
			</if>
		</where>
		ORDER BY v.creationDate DESC
	</select>
	<select id="getVesionById" resultType="com.appinfo.pojo.AppVersion">
		SELECT v.*,
		(SELECT a.softwareName FROM `app_info` a WHERE a.id=v.appId) AS softwareName,
		(SELECT d.valueName FROM `data_dictionary` d
		WHERE d.typeCode='APP_STATUS'
		AND d.valueId=v.publishStatus) AS
		publishStatus
		FROM `app_version` v
		<where>
			<if test="id !=0 and id != null">
				id=#{id}
			</if>
		</where>
	</select>
	<!--修改版本信息  -->
	<update id="modify">
		update app_version
		<trim prefix="set" suffixOverrides="," suffix="where id=#{id}">
			<if test="versionNo != null">versionNo=#{versionNo},</if>
			<if test="versionInfo != null">versionInfo=#{versionInfo},</if>
			<if test="publishStatus != null">publishStatus=#{publishStatus},</if>
			<if test="downloadLink != null">downloadLink=#{downloadLink},</if>
			<if test="apkLocPath != null">apkLocPath=#{apkLocPath},</if>
			<if test="versionSize != null">versionSize=#{versionSize},</if>
			<if test="apkFileName != null">apkFileName=#{apkFileName},</if>
			<if test="modifyBy != null">modifyBy=#{modifyBy},</if>
			<if test="modifyDate != null">modifyDate=#{modifyDate},</if>
		</trim>
	</update>
	<!--删除文件图片  -->
	<update id="delFile">
		update app_version
		   set apkLocPath=NULL,
		       downloadLink = NULL,
		       apkFileName=NULL
		 where id=#{id}
	</update>
	<insert id="addVersion" parameterType="com.appinfo.pojo.AppVersion" useGeneratedKeys="true" keyProperty="id">
		insert into app_version (appId,versionNo,versionInfo,publishStatus,
								downloadLink,versionSize,apkLocPath,apkFileName,createdBy,creationDate)
				values(#{appId},#{versionNo},#{versionInfo},#{publishStatus},#{downloadLink},
					   #{versionSize},#{apkLocPath},#{apkFileName},#{createdBy},#{creationDate})
	</insert>
	<delete id="delByAppId">
		delete 
		  from app_version
		 where appId=#{id}
	</delete>
</mapper>